apiVersion: v1
kind: ServiceAccount
metadata:
  name: og-describer-entraid
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-describer-entraid
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-describer-entraid
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 1
  {{- else }}
  replicas: 10
  {{- end }}
  selector:
    matchLabels:
      app: og-describer-entraid
  template:
    metadata:
      labels:
        app: og-describer-entraid
    spec:
      serviceAccountName: og-describer-entraid
      containers:
        - name: og-describer-azure
          image: "{{ .Values.opengovernance.docker.registry }}/og-describer-entraid:{{ .Values.opengovernance.docker.tags.describeWorkerEntraid }}"
          command: ["/og-describer-entraid"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: NATS_URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-describer-entraid-manuals
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-describer-entraid-manuals
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 0
  {{- else }}
  replicas: 0
  {{- end }}
  selector:
    matchLabels:
      app: og-describer-entraid-manuals
  template:
    metadata:
      labels:
        app: og-describer-entraid-manuals
    spec:
      serviceAccountName: og-describer-entraid
      containers:
        - name: og-describer-azure
          image: "{{ .Values.opengovernance.docker.registry }}/og-describer-entraid:{{ .Values.opengovernance.docker.tags.describeWorkerEntraid }}"
          command: ["/og-describer-entraid"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: NATS_URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
            - name: MANUAL_TRIGGERS
              value: "true"