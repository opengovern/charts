apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-aws-describer
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-aws-describer
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 1
  {{- else }}
  replicas: 3
  {{- end }}
  selector:
    matchLabels:
      app: og-aws-describer
  template:
    metadata:
      labels:
        app: og-aws-describer
    spec:
      serviceAccountName: og-aws-describer
      containers:
        - name: og-aws-describer
          image: "{{ .Values.opengovernance.docker.registry }}/og-aws-describer:{{ .Values.opengovernance.docker.tags.describeWorkerAWS }}"
          command: ["/og-aws-describer"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: AWS_DESCRIBER_NATS__URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-azure-describer
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-azure-describer
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 1
  {{- else }}
  replicas: 3
  {{- end }}
  selector:
    matchLabels:
      app: og-azure-describer
  template:
    metadata:
      labels:
        app: og-azure-describer
    spec:
      serviceAccountName: og-azure-describer
      containers:
        - name: og-azure-describer
          image: "{{ .Values.opengovernance.docker.registry }}/og-azure-describer:{{ .Values.opengovernance.docker.tags.describeWorkerAzure }}"
          command: ["/og-azure-describer"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: AZURE_DESCRIBER_NATS__URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-aws-describer-manuals
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-aws-describer-manuals
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 0
  {{- else }}
  replicas: 3
  {{- end }}
  selector:
    matchLabels:
      app: og-aws-describer-manuals
  template:
    metadata:
      labels:
        app: og-aws-describer-manuals
    spec:
      serviceAccountName: og-aws-describer
      containers:
        - name: og-aws-describer
          image: "{{ .Values.opengovernance.docker.registry }}/og-aws-describer:{{ .Values.opengovernance.docker.tags.describeWorkerAWS }}"
          command: ["/og-aws-describer"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: AWS_DESCRIBER_NATS__URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
            - name: MANUAL_TRIGGERS
              value: "true"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: og-azure-describer-manuals
  namespace: {{ .Release.Namespace }}
  labels:
    app: og-azure-describer-manuals
spec:
  minReadySeconds: 10
  {{- if eq .Values.keda.enabled true }}
  replicas: 0
  {{- else }}
  replicas: 3
  {{- end }}
  selector:
    matchLabels:
      app: og-azure-describer-manuals
  template:
    metadata:
      labels:
        app: og-azure-describer-manuals
    spec:
      serviceAccountName: og-azure-describer
      containers:
        - name: og-azure-describer
          image: "{{ .Values.opengovernance.docker.registry }}/og-azure-describer:{{ .Values.opengovernance.docker.tags.describeWorkerAzure }}"
          command: ["/og-azure-describer"]
          imagePullPolicy: Always
          #resources:
          #  limits:
          #    cpu: 500m
          #    memory: 1Gi
          #  requests:
          #    cpu: 100m
          #    memory: 300Mi
          env:
            - name: AZURE_DESCRIBER_NATS__URL
              value: "{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222"
            - name: MANUAL_TRIGGERS
              value: "true"